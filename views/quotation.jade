extends _layout.jade
include ./mixins/_product.jade

block content
  - var id          = quotation ? '#' + quotation._id : '#quot-' + quotationId
  - var submitMsg   = quotation ? 'Update quotation' : 'Create quotation'
  - var formAction  = quotation ? '/quotation/' + quotation._id : '/quotation'
  - var subtotal    = quotation ? quotation.total : total
  h1
    | Invoice&nbsp;
    span.id= id
  form(method="post" action=formAction)
    input(type="hidden", value=quotationId, name="id")
    .row
      .cell: fieldset
        h2.legend Customer
        .input
          //- TODO make an input-select :P
          //- https://ughzoid.wordpress.com/2013/01/19/jquery-html-select-element-with-editable-input-field/
          label.item(for="customer") Customer
          datalist#customer-list
            if customers && customers.length
              each customer in customers
                option(value=customer.name)
          input.field(
            id="customer"
            name="customer"
            list="customer-list"
            type="text"
            value=quotation ? quotation.customer : null
          )
      .cell-1-3: fieldset
        h2.legend Meta informations
        .input
          label.item(for="tax") tax
          input.field.js-tax(
            id="tax"
            name="tax"
            type="number"
            step="any"
            value=quotation ? quotation.tax : config.tax
          )
    fieldset
      h2.legend Body
      .input
        label.item(for="title") Title
        input.field(
          id="title"
          name="title"
          type="text"
          value=quotation ? quotation.title : null
        )
      table.table-form(cellspacing=0)
        thead
          tr
            th Désignation
            th Jours
            th PU HT
            th Total HT
            th
        tbody.js-products
          if quotation
            each product, i in quotation.products
              +_product(i, product)
          else
            +_product(0, emptyProduct)
        tfoot
          tr
            td(colspan=3) Total Net
            td
              |€&nbsp;
              span.js-total-net=quotation ? quotation.price.net : emptyTotal.net
            td
          tr
            td(colspan=3) Taxes
            td
              |€&nbsp;
              span.js-total-tax=quotation ? quotation.price.taxes : emptyTotal.taxes
            td
          tr
            td(colspan=3) Total with taxes
            td
              |€&nbsp;
              span.js-total-all=quotation ? quotation.price.total : emptyTotal.total
            td
      .detail-actions
        button.js-add-product.btn-secondary(type="button") Add a line

    .actions
      button.btn(type="submit", name="convertToInvoice", value="false")= submitMsg
      if quotation
        //- | &nbsp;
        //- button.btn(type="submit", name="convertToInvoice", value="true") Convert To Invoice
        | &nbsp;
        a.btn-secondary(href="/print/#{quotation._id}") Print
        | &nbsp;
        a.btn-secondary(href="/quotation") New quotation
