extends _layout.jade
include ./mixins/_product.jade

block content
  - var id          = quotation ? '#' + quotation._id : '#quot-' + quotationId
  - var submitMsg   = quotation ? 'Update quotation' : 'Create quotation'
  - var formAction  = quotation ? '/quotation/' + quotation._id : '/quotation'
  - var subtotal    = quotation ? quotation.total : total
  h1
    | Invoice&nbsp;
    span.id= id
  form(method="post" action=formAction)
    input(type="hidden", value=quotationId, name="id")
    .row
      fieldset.cell.card
        .input
          //- TODO make an input-select :P
          //- https://ughzoid.wordpress.com/2013/01/19/jquery-html-select-element-with-editable-input-field/
          label.item(for="customer") Customer
          datalist#customer-list
            if customers && customers.length
              each customer in customers
                option(value=customer.name)
          input.field(
            id="customer"
            name="customer"
            list="customer-list"
            type="text"
            value=quotation ? quotation.customer : null
          )
        if quotation
          .row
            .cell-1-4
              .input
                label.item(for="send") send
                input.field.js-send(
                  id="send"
                  name="status[send]"
                  type="checkbox"
                  checked=quotation && quotation.time.send !== false
                  disabled=quotation && quotation.time.send !== false
                )
              div=quotation && formatDate(quotation.time.send)
            .cell-1-4
              .input
                label.item(for="validated") validated
                input.field.js-validated(
                  id="validated"
                  name="status[validated]"
                  type="checkbox"
                  checked=quotation && quotation.time.validated !== false
                  disabled=quotation && quotation.time.validated !== false
                )
              div=quotation && formatDate(quotation.time.validated)
            .cell-1-4
              .input
                label.item(for="signed") signed
                input.field.js-signed(
                  id="signed"
                  name="status[signed]"
                  type="checkbox"
                  checked=quotation && quotation.time.signed !== false
                  disabled=quotation && quotation.time.signed !== false
                )
              div=quotation && formatDate(quotation.time.signed)
            .cell-1-4
              .input
                label.item(for="done") done
                input.field.js-done(
                  id="done"
                  name="status[done]"
                  type="checkbox"
                  checked=quotation && quotation.time.done !== false
                  disabled=quotation && quotation.time.done !== false
                )
              div=quotation && formatDate(quotation.time.done)
      fieldset.cell-1-5.card
        .input
          label.item(for="tax") tax
          input.field.js-tax(
            id="tax"
            name="tax"
            type="number"
            step="any"
            value=quotation ? quotation.tax : config.tax
          )

    fieldset
      .input
        label.item(for="title") Title
        input.field(
          id="title"
          name="title"
          type="text"
          value=quotation ? quotation.title : null
        )
      table.table-form(cellspacing=0)
        thead
          tr
            th Désignation
            th Jours
            th PU HT
            th Total HT
            th
        tbody.js-products
          if quotation
            each product, i in quotation.products
              +_product(i, product)
          else
            +_product(0, emptyProduct)
        tfoot
          tr
            td(colspan=3) Total Net
            td
              |€&nbsp;
              span.js-total-net=quotation ? quotation.price.net : emptyTotal.net
            td
          tr
            td(colspan=3) Taxes
            td
              |€&nbsp;
              span.js-total-tax=quotation ? quotation.price.taxes : emptyTotal.taxes
            td
          tr
            td(colspan=3) Total with taxes
            td
              |€&nbsp;
              span.js-total-all=quotation ? quotation.price.total : emptyTotal.total
            td
      .detail-actions
        button.js-add-product.btn-secondary(type="button") Add a line

    .actions
      button.btn(type="submit", name="convertToInvoice", value="false")= submitMsg
      if quotation
        //- | &nbsp;
        //- button.btn(type="submit", name="convertToInvoice", value="true") Convert To Invoice
        | &nbsp;
        a.btn-secondary(href="/print/#{quotation._id}") Print
        | &nbsp;
        a.btn-secondary(href="/quotation") New quotation
  | !{reactDom}
